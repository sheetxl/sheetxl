import { type ICommand, Command } from '@sheetxl/utils-react';
import { DefaultDynamicIconService } from '@sheetxl/utils-react';

import { ITaskPaneArea } from '@sheetxl/react';
import { DefaultTaskPaneRegistry } from '@sheetxl/react';

import { AITaskPane } from './AITaskPane';

export const AIPlugin = () => {
  DefaultDynamicIconService.register(
    'plugin-llm', {
      icons: {
        "ai.assistant": {
          svg: [
            {
              className: "fill",
              d: "m 5.375,0.81445313 c -0.2719517,0 -0.5058481,0.17941655 -0.578125,0.44140627 C 4.0930345,3.8037291 3.6415113,4.2552697 1.09375,4.9589844 0.83168799,5.0312771 0.65234375,5.265165 0.65234375,5.5371094 c 0,0.2703595 0.18107141,0.5078432 0.44140625,0.5800781 2.5480474,0.7038896 2.9994092,1.1543557 3.703125,3.703125 0.072293,0.2620615 0.3061806,0.4414065 0.578125,0.4414065 0.2706425,0 0.5078032,-0.179424 0.5800781,-0.4414065 0.7038406,-2.5478698 1.1553637,-2.9994103 3.703125,-3.703125 0.2624009,-0.072386 0.4394529,-0.310792 0.4394529,-0.5800781 0,-0.2713041 -0.1778078,-0.5055265 -0.4394529,-0.578125 C 7.1101556,4.2550948 6.6587941,3.8046286 5.9550781,1.2558594 5.882787,0.99380289 5.6456338,0.81445312 5.375,0.81445313 Z m 0,2.46679687 C 5.8702784,4.3983835 6.5157106,5.0438176 7.6328125,5.5390625 6.5156791,6.0343409 5.8702449,6.6797731 5.375,7.796875 4.8797217,6.6797416 4.2342894,6.0343074 3.1171875,5.5390625 4.2343209,5.0437842 4.8797551,4.398352 5.375,3.28125 Z"
            },
            {
              className: "fill",
              d: "m 6.6132812,15.238281 c -0.27099,0 -0.5081536,0.182648 -0.5800781,0.44336 -0.5874846,2.127729 -0.9564072,2.496616 -3.0839843,3.083984 -0.2620661,0.07229 -0.4414063,0.30618 -0.4414063,0.578125 0,0.270359 0.1810478,0.507837 0.4414063,0.580078 2.1277291,0.587485 2.4966152,0.956405 3.0839843,3.083984 0.072291,0.262057 0.3094447,0.441407 0.5800781,0.441407 0.2719518,0 0.5058415,-0.179394 0.578125,-0.441407 0.5874846,-2.127729 0.9564075,-2.496616 3.0839848,-3.083984 0.262061,-0.07229 0.441406,-0.309445 0.441406,-0.580078 0,-0.271351 -0.181347,-0.505967 -0.441406,-0.578125 C 8.1476615,18.17814 7.7787754,17.80922 7.1914062,15.681641 7.1195546,15.421177 6.8852623,15.238281 6.6132812,15.238281 Z m 0,2.402344 c 0.3907307,0.807263 0.894027,1.311961 1.7011719,1.703125 -0.8071311,0.391158 -1.310436,0.895848 -1.7011719,1.703125 -0.3911019,-0.807382 -0.8957288,-1.312018 -1.703125,-1.703125 0.8073822,-0.391102 1.3120179,-0.895729 1.703125,-1.703125 z" },
            {
              className: "fill accent",
              d: "m 14.029297,2.875 c -0.271952,0 -0.505843,0.1793973 -0.578125,0.4414063 -1.540279,5.5780749 -2.65926,6.6958557 -8.2363283,8.2363277 -0.2620609,0.07229 -0.4414062,0.309445 -0.4414062,0.580079 0,0.27135 0.1813507,0.505967 0.4414062,0.578125 5.5780753,1.540279 6.6958563,2.65926 8.2363283,8.236328 0.07229,0.262066 0.306181,0.441406 0.578125,0.441406 0.27064,0 0.507797,-0.179402 0.580078,-0.441406 1.540279,-5.578075 2.659261,-6.695856 8.236328,-8.236328 0.262416,-0.07239 0.439453,-0.30755 0.439453,-0.578125 0,-0.270004 -0.177794,-0.507476 -0.439453,-0.580079 C 17.267628,10.012455 16.149847,8.8934767 14.609375,3.3164063 14.537084,3.0543502 14.299931,2.875 14.029297,2.875 Z m 0.002,2.6757812 c 1.27631,3.8048214 2.775257,5.3063398 6.580078,6.5820318 -3.804801,1.276508 -5.304585,2.777189 -6.580078,6.582031 C 12.75476,14.909928 11.254155,13.408486 7.4492187,12.132813 11.254134,10.856322 12.755577,9.3557177 14.03125,5.5507812 Z"
            }
          ]
        }
      },
      overrides: {
        "excel": {
          "ai.assistant": { svg: [{ className: "fill", d: "M…excel-alt…" }] }
        },
        "gsheets": {
          "ai.assistant": { svg: [{ className: "line", d: "M…gsheets-alt…" }] }
        }
      }
    }
  );

  DefaultTaskPaneRegistry.registerTaskPane({
    key: 'ai',
    contributionPoints: ['ribbon/home:100', 'ribbon/view:100'],
    getTitle() {
      return 'AI Assistant';
    },
    getIcon(): React.ReactElement | string {
      return 'plugin-llm:ai.assistant';
    },
    createCommand(taskPaneArea: ITaskPaneArea): ICommand {
      return new Command<string>(`openAIAssistant`, null, {
        label: `AI Assistant\u2026`, // '...' // ellipsis
        icon: 'plugin-llm:ai.assistant',
        // shortcut: [{
        //   key: 'S',
        //   modifiers: [KeyModifiers.Shift, KeyModifiers.Ctrl]
        // }, {
        //   key: 'F12'
        // }],
        description: `Open AI Assistant.`
      }, (args?: unknown, command?: ICommand<unknown, unknown>): void | boolean | Promise<boolean> | Promise<void> => {
        taskPaneArea.activateTaskPane('ai', { focus: true });
      });
    },
    renderTaskPane: AITaskPane
  }, true);

}